---
import Layout from '~/layouts/PageLayout.astro';

import Hero from '~/components/widgets/Hero.astro';
import Content from '~/components/widgets/Content.astro';
import { getPermalink } from '~/utils/permalinks';

const metadata = {
  title: 'Personal Homepage Demo',
};
---

<Layout metadata={metadata}>
  <div data-scroll-container>
    <section data-scroll-section id="home" class="min-h-screen flex items-center justify-center">
      <Hero
        title="<span class='text-large'>Embedded software</span> that <span class='highlight-primary'>talks to hardware</span>, <span class='highlight-secondary'>runs on time</span>, and <span class='highlight-accent'>scales</span> with your process."
        tagline="<span class='highlight'>Startup</span>, <span class='highlight'>SME</span>, or <span class='highlight'>industrial group</span> : if you need extra embedded expertise, I'm here to help."
        actions={[{ variant: 'primary', text: 'Contact', href: getPermalink('/contact#form') }]}
      >
      </Hero>
    </section>
    
    <section data-scroll-section id="services" class="min-h-screen flex items-center justify-center">
      <Content
        title="Services"
        subtitle="What I can do for you"
        tagline=""
        content={`<Fragment>
          <h2 class="text-2xl font-bold mb-2">Embedded Software Development</h2>
          <p>
            From concept to production, I develop embedded software that runs on microcontrollers, DSPs, and custom hardware.<br />
            <br />
            <strong>Key areas:</strong><br />
          </p>
          <ul class="list-disc pl-6 mt-2 space-y-1">
            <li>Real-time systems and RTOS integration</li>
            <li>Device drivers and hardware abstraction layers</li>
            <li>Communication protocols (I2C, SPI, UART, CAN, Ethernet)</li>
            <li>Sensor integration and signal processing</li>
            <li>Power management and low-power design</li>
            <li>Bootloader and firmware update systems</li>
          </ul>
        </Fragment>`}
      >
      </Content>
    </section>
    
    <section data-scroll-section id="about" class="min-h-screen flex items-center justify-center">
      <Content
        title="About"
        subtitle="Who I am"
        tagline=""
        content={`<Fragment>
          <h2 class="text-2xl font-bold mb-2">About me</h2>
          <p>
            After years in several companies in embedded systems, I'm here at your service.<br />
            Easy-going girl with a strong sense of doing great work.<br />
            <br />
            3 fun facts :<br />
          </p>
          <ul class="list-disc pl-6 mt-2 space-y-1">
            <li>I started my career in a big company, but I prefer small teams where I can make a difference.</li>
            <li>First time I became team leader, the next 3 months I handled 10 project managers. I prefer delivering good code now.</li>
            <li>I keep pushing in tech even if I'm almost always the only tech girl in the company. So believe me, I love my job.</li>
          </ul>
        </Fragment>`}
      >
      </Content>
    </section>
  </div>
</Layout>

<script>
  import LocomotiveScroll from 'locomotive-scroll';
  import 'locomotive-scroll/dist/locomotive-scroll.css';

  document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Locomotive Scroll loaded');
    
    // Configuration simple
    const scroll = new LocomotiveScroll({
      el: document.querySelector('[data-scroll-container]'),
      smooth: true,
      lerp: 0.1,
      multiplier: 1
    });
    
    // Fonction pour r√©initialiser toutes les animations
    function resetAllAnimations() {
      const sections = ['home', 'services', 'about'];
      sections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
          const elements = section.querySelectorAll('h1, h2, h3, p, li, .text-large, .highlight-primary, .highlight-secondary, .highlight-accent, .highlight');
          elements.forEach(el => {
            const element = el as HTMLElement;
            element.style.transition = 'none';
            element.style.opacity = '0';
            element.style.transform = 'translateY(20px)';
          });
        }
      });
    }
    
    // Fonction simple pour animer
    function animateSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (!section) return;
      
      // Trouver tous les √©l√©ments √† animer
      const elements = section.querySelectorAll('h1, h2, h3, p, li, .text-large, .highlight-primary, .highlight-secondary, .highlight-accent, .highlight');
      
      // R√©initialiser tous les √©l√©ments
      elements.forEach(el => {
        const element = el as HTMLElement;
        element.style.opacity = '0';
        element.style.transform = 'translateY(20px)';
        element.style.transition = 'none';
      });
      
      // Forcer reflow pour s'assurer que la r√©initialisation est appliqu√©e
      void (section as HTMLElement).offsetHeight;
      
      // Animer avec d√©lai
      elements.forEach((el, index) => {
        setTimeout(() => {
          const element = el as HTMLElement;
          console.log(`üé¨ Starting animation for element ${index} in ${sectionId}`);
          console.log(`üé¨ Element before: opacity=${element.style.opacity}, transform=${element.style.transform}`);
          
          element.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
          element.style.opacity = '1';
          element.style.transform = 'translateY(0)';
          
          console.log(`üé¨ Element after: opacity=${element.style.opacity}, transform=${element.style.transform}`);
          console.log(`‚ú® Animated element ${index} in ${sectionId}`);
        }, index * 100);
      });
    }
    
    // Gestion des clics sur menu
    document.addEventListener('click', function(e) {
      const target = e.target as HTMLElement;
      const link = target.closest('a[href^="#"]');
      
      if (link) {
        e.preventDefault();
        const href = link.getAttribute('href');
        if (!href || href === '#') return;
        
        const targetId = href.substring(1);
        console.log(`üñ±Ô∏è Menu click: ${targetId}`);
        
        // Debug: afficher la structure de la section
        const targetSection = document.getElementById(targetId);
        if (targetSection) {
          console.log(`üèóÔ∏è Section ${targetId} structure:`, targetSection.innerHTML.substring(0, 200));
        }
        
        // R√©initialiser toutes les animations d'abord
        resetAllAnimations();
        
        // Scroll vers la section
        if (targetSection) {
          scroll.scrollTo(targetSection, {
            duration: 1,
            easing: [0.25, 0.46, 0.45, 0.94]
          });
          
          // Forcer l'animation apr√®s le scroll (peu importe l'√©tat actuel)
          setTimeout(() => {
            console.log(`üñ±Ô∏è Forcing animation for ${targetId} after menu click`);
            animateSection(targetId);
          }, 500);
        }
      }
    });
    
    // Animation au scroll
    let currentVisibleSection = '';
    
    scroll.on('scroll', (_args) => {
      const sections = ['home', 'services', 'about'];
      const windowHeight = window.innerHeight;
      
      sections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
          const rect = section.getBoundingClientRect();
          
          // Si la section est visible (crit√®res plus pr√©cis)
          if (rect.top < windowHeight * 0.5 && rect.bottom > windowHeight * 0.5) {
            // Animer seulement si on a chang√© de section
            if (currentVisibleSection !== sectionId) {
              currentVisibleSection = sectionId;
              animateSection(sectionId);
            }
          }
        }
      });
    });
    
    // Animation initiale
    setTimeout(() => {
      animateSection('home');
    }, 300);
    
    // Mise √† jour au resize
    window.addEventListener('resize', () => {
      scroll.update();
    });
  });
</script>

<style>
  /* Reset et styles de base */
  * {
    box-sizing: border-box;
  }
  
  /* Fond du site */
  body {
    background-color: #eeeeee !important;
  }
  
  [data-scroll-container] {
    background-color: #eeeeee !important;
  }
  
  /* Locomotive Scroll styles */
  [data-scroll-container] {
    overflow: hidden;
  }
  
  [data-scroll-section] {
    position: relative;
    overflow: hidden;
  }
  
  /* Full-page sections */
  [data-scroll-section] {
    min-height: 100vh !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    position: relative !important;
    padding: 2rem 0;
  }
  
  /* Effet de parallaxe subtil */
  [data-scroll] {
    will-change: transform;
  }
  
  /* Animations simples - styles de base */
  h1, h2, h3, p, li, .text-large, .highlight-primary, .highlight-secondary, .highlight-accent, .highlight {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }
  
  /* Couleurs des titres */
  h1, h2, h3 {
    color: #222831 !important;
  }
  
  /* Couleurs des textes de d√©tails */
  p, li {
    color: #393e46 !important;
  }
  
  /* Couleurs des highlights avec effet glow */
  .highlight-primary, .highlight-secondary, .highlight-accent, .highlight {
    color: #00adb5 !important;
    text-shadow: 0 0 20px rgba(0, 173, 181, 0.5) !important;
  }
  
  /* Effet glow pour les boutons primary */
  .btn-primary {
    background-color: #00adb5 !important;
    border-color: #00adb5 !important;
    box-shadow: 0 0 20px rgba(0, 173, 181, 0.5) !important;
    color: white !important;
  }
  
  .btn-primary:hover {
    background-color: #009aa1 !important;
    border-color: #009aa1 !important;
    box-shadow: 0 0 30px rgba(0, 173, 181, 0.7) !important;
    color: white !important;
  }
  
  /* Styles sp√©cifiques pour le bouton Contact dans le header */
  header .btn-primary,
  nav .btn-primary,
  .aw-header .btn-primary {
    background-color: #00adb5 !important;
    border-color: #00adb5 !important;
    box-shadow: 0 0 20px rgba(0, 173, 181, 0.5) !important;
    color: white !important;
  }
  
  header .btn-primary:hover,
  nav .btn-primary:hover,
  .aw-header .btn-primary:hover {
    background-color: #009aa1 !important;
    border-color: #009aa1 !important;
    box-shadow: 0 0 30px rgba(0, 173, 181, 0.7) !important;
    color: white !important;
  }
  
  /* √âl√©ments visibles */
  h1[style*="opacity: 1"], h2[style*="opacity: 1"], h3[style*="opacity: 1"], 
  p[style*="opacity: 1"], li[style*="opacity: 1"], 
  .text-large[style*="opacity: 1"], .highlight-primary[style*="opacity: 1"], 
  .highlight-secondary[style*="opacity: 1"], .highlight-accent[style*="opacity: 1"], 
  .highlight[style*="opacity: 1"] {
    opacity: 1 !important;
    transform: translateY(0) !important;
  }
  
  /* S'assurer que le header reste toujours visible */
  header,
  .aw-header,
  nav {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 1000 !important;
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
  }
  
  /* Ajuster le padding-top pour compenser le header fixe */
  [data-scroll-container] {
    padding-top: 80px !important;
  }
  
  /* S'assurer que les sections commencent sous le header */
  [data-scroll-section] {
    padding-top: 20px !important;
  }
  
  /* Style pour le lien actif dans la navigation */
  .aw-link-active {
    color: #00adb5 !important;
    font-weight: 600;
  }
  
  /* Am√©lioration du scroll smooth */
  html {
    scroll-behavior: smooth;
  }
  
  /* Optimisation pour mobile */
  @media (max-width: 768px) {
    [data-scroll-section] {
      padding: 1rem 0;
    }
    
    /* Ajuster le padding pour mobile */
    [data-scroll-container] {
      padding-top: 60px !important;
    }
  }
  

</style>
